{% extends "__tabnav.html.j2" %}
{# Detail info about a particular meet, at /meets/<meet-id> #}
{% from "__macros.html.j2" import MACRO_MAKE_TAB, MACRO_MAKE_TAB_CONTENT with context %}
{% from "__macros.html.j2" import SHOW_MY_SCHOOL_INDICATOR %}
{% from "/athletes/_macro_athlete_list.html.j2" import MACRO_ATHLETE_LIST %}

{% set schools_entered = meet.schools_entered() %}

{% block myschool_indicator %}
  {{SHOW_MY_SCHOOL_INDICATOR(meet.host_school)}}
{% endblock %}


{% block secondary_nav_title %}
  {{ meet.name }}
{% endblock secondary_nav_title %}


{% block nav2_admin_url %}
  href="{{url_for('show_edit_meet_form', meet_id=meet.id) }}"
{% endblock nav2_admin_url %}>


{% block nav2_subtitle %}
  <div class="d-flex flex-row">
    <div>{{ meet.date.strftime("%B %d, %Y") }}</div>
    <a class="ml-auto" href="{{ url_for('show_school_detail', school_id=meet.host_school.id) }}">
      Host School: {{ meet.host_school.name }}
    </a>
  </div>

  <div class="d-flex">
    {{ meet.status }}
  </div>

  <h5>
    <div class="d-flex flex-row ">
      <div class="bg-info p-3 text-center">{{ meet.get_athletes() | length }} Athletes</div>
      <div class="bg-secondary p-3 text-center">{{ schools_entered | length }} Schools</div>
      <div class="bg-info p-3 text-center">{{ meet.divisions | length }} Divisions</div>
      <div class="bg-secondary p-3 text-center">{{ meet.events | length }} Events</div>
      <div class="bg-info p-3 text-center">{{ meet.mdes | length }} MDEs</div>
      <div class="bg-secondary p-3 text-center"> XXX Heats</div>
      <div class="bg-info p-3 text-center">{{ meet.entries | length }} Entries</div>
    </div>
  </h5>
  {% if session.user_school_id not in meet.schools_entered() %}
    <button class="btn btn-success">Enter Meet</button>
  {% else %}
    <button class="btn btn-primary">Revise My Meet Entries</button>
  {% endif %}
{% endblock nav2_subtitle %}


{% block tab_navs %}
  {{ MACRO_MAKE_TAB("mdetail-events-tab", true, "Event Schedule") }}
  {{ MACRO_MAKE_TAB("mdetail-schools-tab", false, "Schools") }}
  {{ MACRO_MAKE_TAB("mdetail-athletes-tab", false, "Athletes") }}
  {{ MACRO_MAKE_TAB("mdetail-meetinfo-tab", false, "Meet Info") }}
{% endblock tab_navs %}


{# The expandable event cards that are on the accordions on   #}
{# MeetDetail > Schedule of events  #}
{% block tab_content %}

  {% call MACRO_MAKE_TAB_CONTENT(
      "mdetail-events-tab", true, 
      "/meets/event_accordion.html.j2") %}
  {% endcall %}


  {% call MACRO_MAKE_TAB_CONTENT("mdetail-schools-tab", false) %}

    <table id="meet-school-list" class="display" data-order='[[ 0, "asc" ]]' data-page-length='100'>
      <thead>
        <tr>
          <th>School name</th>
          <th>Number of athletes</th>
          <th>Number of entries</th>
          <th>Entry status</th>
        </tr>
      </thead>
      <tbody>
        {% for school in schools_entered %}
          <tr>
            <td>
              <a href="{{url_for('show_school_detail', school_id=school.id)}}">
                {{ school.name }}
              </a>
            </td>
            <td>
              {{meet.get_athletes(school_id=school.id) | length }} Athletes
            </td>
            <td>
              {{meet.get_school_entries(school_id=school.id) | length}} Entries
            </td>
            <td>
              
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  {% endcall %}


  {% call MACRO_MAKE_TAB_CONTENT("mdetail-athletes-tab", false) %}
  {{ MACRO_ATHLETE_LIST(meet.get_athletes(), "meet-athlete-list")}}
  {% endcall %}


  {% call MACRO_MAKE_TAB_CONTENT("mdetail-meetinfo-tab", false) %}
    <div class="mb-4">
      <a href="{{url_for('show_edit_meet_form', meet_id=meet.id)}}">
        <button class="btn btn-primary">Edit Meet</button>
      </a>
    </div>
    <div class="row">
      <div class="col-md-6 card p-3">
        <h5>Order of Events</h5>
        <ol>
          {% for e_order in meet.event_orderings %}
            <li>{{ e_order.event.name }}
              <ol>
                {% for d_order in meet.div_orderings %}
                  <li>{{ d_order.division.name }}</li>
                {% endfor %}
              </ol>
            </li>
          {% endfor %}
        </ol>
      </div>
      <div class="col-md-6">
        <div class="card p-3">
          <h5>Meet Info</h5>
          <strong>Name:</strong> {{ meet.name }}<br>
          <strong>Description:</strong> {{ meet.description }}<br>
          <strong>Date:</strong> {{ meet.date }}<br>
          <strong>Host School:</strong> {{ meet.host_school.name }}<br>
          <strong>Status:</strong> {{ meet.status }}<br>
          <strong>Manager users:</strong>
          {% if meet.manager_users %}
            <ul>
              {% for user in meet.manager_users %}
                <li>{{ user.email }}, {{ user.school_id }}</li>
              {% endfor %}
            </ul>
          {% else %}
            No manager users
          {% endif %}
        </div>
        <div class="card p-3">
          <h5>Meet Rules</h5>
          <strong>Max number of events per athlete:</strong> {{ meet.max_entries_per_athlete }}<br>
          <strong>Maximum number of teammates per division within an event:</strong>
          {{ meet.max_teammates_per_event }}<br>
          <strong>Overall maximum number of heats per divison within an event (can be overridden at MDE level):</strong> {{ meet.max_heats_per_mde }}<br>
        </div>
        <div class="card p-3">
          <h5>Summary Statistics</h5>
          <strong>Assignments:</strong> TODO<br>
          <strong>Over-subscribed Meet-Divisions:</strong> TODO<br>
          <strong>Meet-Divisions with space:</strong> TODO<br>
          <strong>Unassigned athletes:</strong> TODO<br>
          <strong>Athletes with declined assignments:</strong> TODO<br>
        </div>
      </div>
    </div>
    <a href="{{url_for('show_edit_meet_form', meet_id=meet.id)}}">
      <button class="btn btn-primary">Edit Meet</button>
    </a>

  {% endcall %}

{% endblock tab_content %}


{% block my_javascripts %}
{{super()}}
<script type="text/javascript" src="/static/js/tms-datatable.js"></script>
{% endblock my_javascripts %}