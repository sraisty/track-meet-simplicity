{% extends "__tabnav.html.j2" %}
{# Detail info about a particular meet, at /meets/<meet-id> #}

{% from "__macros.html.j2" import MACRO_MAKE_TAB, MACRO_MAKE_TAB_CONTENT with context %}
{% from "__macros.html.j2" import SHOW_MY_SCHOOL_INDICATOR %}

{% block myschool_indicator %}
  {{SHOW_MY_SCHOOL_INDICATOR(meet.host_school)}}
{% endblock %}


{% block secondary_nav_title %}
    {{ meet.name }}
{% endblock secondary_nav_title %}

{% block nav2_admin_url %}
    href="{{url_for('show_edit_meet_form', meet_id=meet.id) }}"
{% endblock nav2_admin_url %}>

{% block nav2_subtitle %}
    <div>
        <a href="{{ url_for('show_school_detail', school_id=meet.host_school.id) }}">
            Host School: {{ meet.host_school.name }}
        </a>
    <div>{{ meet.date.strftime("%B %d, %Y") }}</div>
    <div>{{ meet.get_athletes() | length }} Athletes</div>{{ meet.schools_entered() | length }} Schools</div>
    <div>{{ meet.divisions |  length }} Divisoins</div><div>{{ meet.mdes | length }} MDEs</div>
    <div>{{ meet.events | length }} events</div>
{% endblock nav2_subtitle %}



{% block tab_navs %}
    {{ MACRO_MAKE_TAB("mdetail-events-tab", true, "Event Schedule") }}
    {{ MACRO_MAKE_TAB("mdetail-schools-tab", false, "Schools") }}
    {{ MACRO_MAKE_TAB("mdetail-athletes-tab", false, "Athletes") }}
    {{ MACRO_MAKE_TAB("mdetail-meetinfo-tab", false, "Meet Info") }}
{% endblock tab_navs %}  



{# The expandable event cards that are on the accordions on   #}
{# MeetDetail > Schedule of events  #}
{% block tab_content %}
    {% call MACRO_MAKE_TAB_CONTENT(
        "mdetail-events-tab", true, "/meets/event_accordion.html.j2") %}
    {% endcall %}

    {% call MACRO_MAKE_TAB_CONTENT(
            "mdetail-schools-tab", false) %}
        {% for school in meet.schools_entered() %}
            <p>
                <a href="{{url_for('show_school_detail', school_id=school.id)}}">
                    {# TODO FIX:- This is returning a count of ALL entries and athletes, not just this meet #}
                    {{ school.name }}
                </a>, 
                {{school.athletes | length }} Athletes, 
                {{school.entries | length}} Entries 

            </p>
        {% endfor %} 
    {% endcall %}

    {% call MACRO_MAKE_TAB_CONTENT("mdetail-athletes-tab", false) %}
        {% if meet.get_athletes() %}
            <ul>
            {% for athlete in meet.get_athletes() %}
                <li>
                    <a href="{{url_for('show_athlete_detail', athlete_id=athlete.id)}}">
                        {{ athlete.full_name() }}
                    </a>
                </li>
            {% endfor %}
            </ul>
        {% endif %}
    {% endcall %}

    {% call MACRO_MAKE_TAB_CONTENT("mdetail-meetinfo-tab", false) %}
        <p>{{meet.description}}</p>
    {% endcall %}

{% endblock tab_content %}




{% block my_javascripts %}
    {{super()}}
    <script type="text/javascript" src="/static/js/schools-datatable.js"></script>
{% endblock my_javascripts %}
